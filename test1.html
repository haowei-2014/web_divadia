<html>

<body>

    <table>
        <tr>
            <td>Text to Save:</td>
        </tr>
        <tr>
            <td colspan="3">
                <textarea id="inputTextToSave" style="width:512px;height:256px"></textarea>
            </td>
        </tr>
        <tr>
            <td>Filename to Save As:</td>
            <td>
                <input id="inputFileNameToSaveAs"></input>
            </td>
            <td>
                <button onclick="saveTextAsFile()">Save Text to File</button>
            </td>
        </tr>
        <tr>
            <td>Select a File to Load:</td>
            <td>
                <input type="file" id="fileToLoad">
            </td>
            <td>
                <button onclick="loadFileAsText()">Load Selected File</button>
                <td>
        </tr>
    </table>

    <script type='text/javascript'>
        function saveTextAsFile() {
        //      var xw = getXML();
            txt = "<bookstore><book>";
            txt = txt + "<title>Everyday Italian</title>";
            txt = txt + "<author>Giada De Laurentiis</author>";
            txt = txt + "<year>2005</year>";
            txt = txt + "</book></bookstore>";

            if (window.DOMParser) {
                parser = new DOMParser();
                xmlDoc = parser.parseFromString(txt, "text/xml");
            } else // Internet Explorer
            {
                xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
                xmlDoc.async = false;
                xmlDoc.loadXML(txt);
            }
            //       var textToWrite = document.getElementById("inputTextToSave").value;
            var textToWrite =(new XMLSerializer()).serializeToString(xmlDoc);
            
       //     var textToWrite = xw.flush();
            
            
            var textFileAsBlob = new Blob([textToWrite], {
                type: 'text/xml'
            });
            var fileNameToSaveAs = document.getElementById("inputFileNameToSaveAs").value;

            var downloadLink = document.createElement("a");
            downloadLink.download = fileNameToSaveAs;
            downloadLink.innerHTML = "Download File";
            if (window.webkitURL != null) {
                // Chrome allows the link to be clicked
                // without actually adding it to the DOM.
                downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
            } else {
                // Firefox requires the link to be added to the DOM
                // before it can be clicked.
                downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
                downloadLink.onclick = destroyClickedElement;
                downloadLink.style.display = "none";
                document.body.appendChild(downloadLink);
            }

            downloadLink.click();
        }

        function destroyClickedElement(event) {
            document.body.removeChild(event.target);
        }

        function loadFileAsText() {
           var fileToLoad = document.getElementById("fileToLoad").files[0];

            var fileReader = new FileReader();
            fileReader.onload = function (fileLoadedEvent) {
                var textFromFileLoaded = fileLoadedEvent.target.result;
                document.getElementById("inputTextToSave").value = textFromFileLoaded;
  //              alert("Got the file!");
                getXMLDOM(textFromFileLoaded);
            };
            fileReader.readAsText(fileToLoad, "UTF-8");
            var fileText = fileReader.result;
            


  /*          var x = document.getElementById("fileToLoad").files[0];
            x = x.substring(12, x.length);
            xmlDoc = loadXMLDoc(x);  */
        }      
        
        function getXMLDOM(textFromFileLoaded){
  //          alert(textFromFileLoaded);
            
            if (window.DOMParser) {
                parser = new DOMParser();
                xmlDoc = parser.parseFromString(textFromFileLoaded, "text/xml");
            } else // Internet Explorer
            {
                xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
                xmlDoc.async = false;
                xmlDoc.loadXML(textFromFileLoaded);
            }
            //       var textToWrite = document.getElementById("inputTextToSave").value;
            var textToWrite =(new XMLSerializer()).serializeToString(xmlDoc);
        }
    </script>
</body>

</html>